---
title: "Ethiopia Stochastic Frontiers Analysis Draft 2"
author: "Tomas Morley"
date: "20 March 2017"
output:
  pdf_document: default
  word_document:
    reference_docx: ../Common/word_styles_01.docx
bibliography: ../Common/ETHYG.bib
---

```{r setup, include=FALSE}
# Knitr settings
library(rprojroot)
library(dplyr)
root <- find_root(is_rstudio_project)

library(frontier)
library(knitr)
knitr::opts_chunk$set(
  fig.width=12, fig.height=8,
  dpi = 300,
  echo=FALSE, warning=FALSE, message=FALSE,
  fig.path = file.path(root,"FigTabMap/out-"),
  dev = "CairoPNG",
  dev.args = list(CairoPNG = list(bg = "transparent"))
  )

library(pander)
panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)

source(file.path(root, "Code/production_function_tests.R"))

# Source figures, tables and maps
source(file.path(root, "Code/ETH_fig.R"))
source(file.path(root, "Code/ETH_tab.R"))
# source(file.path(root, "Code/ETH_map.R"))

```

# Abstract

This paper adopts the framework developed by Dijk et al. (2016) to decompose the maize yield gap in Ethiopia, combining information from household survey data and 

# Introduction

# Data

The main data source is the Living Standards Measurement Study - Integrated Surveys on Agriculture (LSMS-ISA) Ethiopian Socioeconomic survey (ESS). This survey was implemented by the Central Statistical Agency of Ethiopia (CSA) and was funded by the World Bank through a grant from the Bill and Melinda Gates foundation. Although part of a panel, the first wave of the ESS did not record crop harvested quantities for a majority of plots making it unsuitable for this analysis. However, the second wave (2013-2014) of the ESS provides detailed information on crop production, input use, environmental and scocioeconomic variables. 

In order to calculate maize yields and input rates, accurate measurements of field areas are required. GPS measurements were recorded for the vast majority of plots in the second wave of the ESS. For those plots lacking a GPS measurement, multiple imputation was used following LSMS-ISA World Bank (2014). Maize yield (`yld`), nitrogen rates (`N`), labour rates (`lab`) and seed rates (`seedha`), are measures of the per hectare application of each variable to a plot. In some cases more than one crop was grown per plot and this is captured in the analysis by the incorporation of variables referencing the number of crops on a field, and whether a field had more than one crop (`crop_count`, `crop_count2`, respectively). Furthermore, variables covering the Ph, soil quality, slope and elevation of the field, and environmental characteristics were also included The longitude and latitude of each household was recorded allowing climate, soil and geographical data to be matched to households from sources including IFPRI, Worlclim, NASA and the Ethiopian Roads Agency amongst others.

__Table 1: Descriptive Statistics__

```{r}
pander(sum_tab)
```

## Estimation procedures

The core estimation method in this paper is the stochastic frontiers (SF) method [@Aigner1977; @Meeusen1977]. This involves specification of the form of a production function and a composite error term that reflects both statistical error in the model and an assymetric inefficiency term.

\begin{equation}\label{folstandardform}
y_i = \alpha + f(x_i, \beta) + \epsilon_i
\end{equation}
\begin{equation}\label{folstandardform}
\epsilon_i = v_i - u_i
\end{equation}
\begin{equation}\label{folstandardform}
v_i \sim \mathbb{N}(0, \sigma_v^2)
\end{equation}
\begin{equation}\label{folstandardform}
u_i \sim \mathbb{N}^+(0, \sigma_u^2)
\end{equation}

Where $y_i$ is the log of maize yield and $x_i$ is the log of the inputs including the nitrogen, labour and seed rates. The composite error term $\epsilon_i$ includes a truncated normal inefficiency term $u_i$ and a statistical error term $v_i$ where $u$ and $v$ are independent. [@Aigner1977] show that the composite error term $\epsilon_i$ follows the following density

\begin{equation}\label{folstandardform}
f_\epsilon(\epsilon_i) = \frac{2}{\sigma}\phi(\frac{\epsilon_i}{\sigma})\Phi(-\frac{\lambda\epsilon_i}{\sigma})
\end{equation}

Given a suitable functional form $f(.)$ The parameters of the stochastic frontiers model can be estimated using maximum likelihood (ML) estimation. Common production functions that have been used in crop yield models include the Cobb Douglass and translog production functions. The translog is the more flexible of the two and includes the squares and interactions of the inputs, nesting the cobb douglass functional form inside its model specification. Which allows a LR test

\begin{equation}\label{folstandardform}
Y_i = f(X_{i1}, X_{i2}, \ldots, X_{iK}; \beta) E_i
\end{equation}

For example in the translog case

\begin{equation}\label{folstandardform}
Y_i = exp \Big(\alpha + \sum_{k=1}^K \beta_k ln X_{ik} + \sum_{k=1}^K \sum_{j=1}^K \gamma_{jk} ln X_{ik} ln X_{ij} \Big) E_i
\end{equation}

Which can then be written in log form

\begin{equation}\label{folstandardform}
y_i = \alpha + \sum_{k=1}^K \beta_k x_{ik} + \sum_{k=1}^K \sum_{j=1}^K \gamma_{jk} x_{ik} x_{ij} + \epsilon_i
\end{equation}

Where $y_i$ is the log of the dependent variable, and we have replaced $ln X$ with $x$. The error term $\epsilon_i$ is the log of the error term and is comprised of the truncated normal technical inefficiency and the symmetric error term $\epsilon_i = v_i - u_i$ as shown above. Setting the parameters $delta$ equal to zero we see that the cobb douglass form is nested within the translog. In addition we can include environmental variables such as the slope and elevation of the plot to the chosen production form yielding the following model in the translog case:

\begin{equation}\label{folstandardform}
y_i = \alpha + \sum_{k=1}^K \beta_k x_{ik} + \sum_{k=1}^K \sum_{j=1}^K \gamma_{jk}x_{ij} x_{ik} + W_i \theta + \epsilon_i
\end{equation}

This form of the translog production function is suitable for estimation via ML SF using the specification in equation 1 - 4 and the density in equation 5. We are interested in the factors which determine inefficiency and this can be incorporated by ammending equation 5 to allow the mean of the truncated normal distribution ( pre-truncated normal?) to depend on exogenous deteminants of inefficiency such as such as the education, age or gender of the farmer or access to markets and extension services. In this case equation 4 becomes

\begin{equation}\label{folstandardform}
u_i \sim \mathbb{N}^+(z_i\delta, \sigma_u^2)
\end{equation}

Where $z_i$ are the exogenous determinants of inefficiency. Estimation is still carried out by maximum likelihood using the density for the error term $epsilon_i$ incorporating this new term. 

We cannot solve for the optimal N analytically and instead we rely on numerical methods.

## Results

The resulting SF ML estimates are presented in table 1 for four models. Model 1 shows the coefficient estimates for the core translog production function terms. Model 2 extend this to include the exogenous determinants of inefficiences. Models 3 and 4 do likewise and also include the environmental variables.

__Table 2: Translog production function__
```{r}
pander(results_tab)
```

The raw coefficients of the exogenous determinants of technical inefficinecy cannot be interpreted as elasticities. However, the marginal effects of each variable can be computed following Kumbhakar & Sun (2013). These are observation specific and a concise estimate of the marginal effects is presented in table 2 in the form of the average partial effects (APE) for models 3 and 4 respectively. 

__Table 3: Marginal effects (APE) of exogenous determinants of inefficiency__
```{r}
pander(ME_tab)
```


__Figure 3: Potential yield__

```{r Fig_2}
Fig_waterfall
```


__Table 4: __

```{r}
pander(ZonalYieldGap_l_sh)
```


